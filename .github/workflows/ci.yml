name: Test SSH Connection

on:
  workflow_dispatch:

jobs:
  testing06:
    name: testing ipv6
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v1

      - name: Set up WARP
        uses: fscarmen/warp-on-actions@v1.1
        with:
          stack: dual

      - name: testing ipv6 for command
        run: |
          curl -m 9 --ipv6 --verbose https://google.com

      - name: testing ipv6
        uses: appleboy/ssh-action@master
        with:
          host: ssh.bairetzlaff.dynv6.net
          username: deployer
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          protocol: tcp6
          port: 2222
          command_timeout: 30s
          script: |
            whoami

# name: Test CI/CD

# on:
#   push:
#     branches: [main]
#   pull_request:

# jobs:
#   test:
#     name: üß™ Run Unit Tests
#     runs-on: ubuntu-latest
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Set up Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: "3.12"

#       - name: Install dependencies
#         run: |
#           pip install -r requirements.txt

#       - name: Run tests
#         run: python -m pytest

#   build:
#     name: üê≥ Build Docker Image
#     needs: test
#     runs-on: ubuntu-latest
#     outputs:
#       image-name: ${{ steps.set_image_name.outputs.IMAGE_NAME }}
#     steps:
#       - uses: actions/checkout@v4

#       - uses: docker/login-action@v2
#         with:
#           registry: ghcr.io
#           username: ${{ github.actor }}
#           password: ${{ secrets.GHCR_TOKEN }}

#       - name: Build and push Docker image
#         id: set_image_name
#         run: |
#           IMAGE_NAME="ghcr.io/${{ github.repository }}:${{ github.sha }}"
#           echo "IMAGE_NAME=$IMAGE_NAME" >> $GITHUB_OUTPUT
#           docker buildx create --use
#           docker buildx build \
#             --platform linux/amd64,linux/arm64 \
#             -t $IMAGE_NAME \
#             --push \
#             .

#   deploy:
#     name: üöÄ Deploy to Raspberry Pi
#     needs: build
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4

#       - name: Setup SSH
#         uses: webfactory/ssh-agent@v0.9.0
#         with:
#           ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

#       - name: üîç Test SSH connectivity
#         run: |
#           echo "Testing SSH connection..."
#           ssh -6 -v -p 2222 -o StrictHostKeyChecking=no  "echo Connected successfully"

#       - name: üê≥ Deploy Docker container
#         run: |
#           IMAGE_NAME="${{ needs.build.outputs.image-name }}"
#           CONTAINER_NAME="crypto_notifier"

#           ssh -6 -p 2222 -o StrictHostKeyChecking=no ${{ secrets.SSH_TARGET }} bash -c "
#             echo 'Pulling latest image: $IMAGE_NAME'
#             docker pull $IMAGE_NAME

#             echo 'Stopping existing container (if any)...'
#             docker stop $CONTAINER_NAME || true
#             docker rm $CONTAINER_NAME || true

#             echo 'Starting new container...'
#             docker run -d --name $CONTAINER_NAME \
#               --restart unless-stopped \
#               -p 8080:8080 \
#               $IMAGE_NAME

#             echo 'Deployment complete!'
#           "
